<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <!-- Bootstrap 3.3.6 -->
  <link rel="stylesheet" href="/Public/bootstrap/css/bootstrap.min.css" />
  <!-- Font Awesome -->
  <link rel="stylesheet" href="/Public/dist/font/font-awesome/4.5.0/css/font-awesome.min.css" />
  <!-- Ionicons -->
  <link rel="stylesheet" href="/Public/dist/font/ionicons/2.0.1/css/ionicons.min.css" />
  <!-- Theme style -->
  <link rel="stylesheet" href="/Public/dist/css/AdminLTE.min.css" />
  <!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
  <link rel="stylesheet" href="/Public/dist/css/skins/_all-skins.min.css" />
  <!-- AdminLTE皮肤默认选择的skin-blue。也可以选择其他的皮肤。确保你应用皮肤类body标签更改生效 -->
  <link rel="stylesheet" href="/Public/dist/css/skins/skin-blue.min.css" />
  <!-- 自定义公共css -->
  <link rel="stylesheet" href="/Public/dist/css/custom.css" />
  <!-- 表格 css -->
  <link rel="stylesheet" href="/Public/plugins/bootstrap-table/bootstrap-table.css" />
  <!-- 开关按钮 css -->
  <link rel="stylesheet" href="/Public/plugins/switch/bootstrap-switch.css" />
  <!-- ztree -->
  <link rel="stylesheet" href="/Public/plugins/ztree/zTreeStyle.css" />
  <!-- 日期 时间 -->
  <link rel="stylesheet" href="/Public/plugins/datetimepicker/jquery.datetimepicker.css" />
  <!-- iCheck for checkboxes and radio inputs -->
  <link rel="stylesheet" href="/Public/plugins/iCheck/all.css" />
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>
<body>
<!--view-start-->
<section class="content">

  <div class="row">
    <div class="col-md-12">
      <div class="box">
        <div class="box-header with-border">
          <form class="form-inline navbar-form navbar-left">
            <div class="form-group">
              <label for="">时间段：</label>
              <input id="begin_time2" class="form-control dataTime" placeholder="开始时间"  type="text" value="">
               至
              <input id="end_time2" class="form-control dataTime" placeholder="结束时间" type="text" value="">
            </div>
            <div class="form-group">
              <button type="button" class="btn btn-primary query" data-color="#39B3D7" data-opacity="0.95">
                <span class="glyphicon glyphicon-search"></span> 查询
              </button>
            </div>  
          </form>
        </div>
        <div class="box-body">
          <div class="row">
            <div class="col-md-12">
              <table id="referrer_table1" class="js-custom-table-data">
                <thead>  
                  <tr>
                    <th data-field="username" data-sortable="true" data-align="center">用户账号</th>
                    <th data-field="name" data-sortable="true" data-align="center">用户名称</th>
                    <th data-field="user_type" data-sortable="true" data-align="center">用户类型</th>
                    <th data-field="create_time" data-sortable="true" data-align="center">创建时间</th>
                    <th data-field="agent_status" data-sortable="true" data-align="center">审核代理商状态</th>
                    <th data-field="reply" data-sortable="true" data-align="center">审核状态原因</th>
                    <th data-field="status" data-sortable="true" data-align="center">状态</th>
                    <th data-field="info" data-sortable="false" data-align="center">统计信息</th>
                    <th data-align="center" data-formatter="viewInviterFormatter" data-events="viewInviterEvents" name="viewInviterFormatter">查看</th>
                  </tr>
                </thead>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<form id="searchForm" name="searchForm" action="">
    <input type="hidden" name="begin_time" id="begin_time" value="" />
    <input type="hidden" name="end_time" id="end_time" value="" />

    <input type="hidden" name="user_id" id="user_id" value="" />
</form>

<!--view-end-->
<!-- REQUIRED JS SCRIPTS -->
<!-- jQuery 2.2.3 -->
<script type="text/javascript" src="/Public/plugins/jQuery/jquery-2.2.3.min.js"></script>
<!-- Bootstrap 3.3.6 -->
<script type="text/javascript" src="/Public/bootstrap/js/bootstrap.min.js"></script>
<!-- Slimscroll -->
<script type="text/javascript" src="/Public/plugins/slimScroll/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script type="text/javascript" src="/Public/plugins/fastclick/fastclick.js"></script>
<!-- AdminLTE App -->
<script type="text/javascript" data-src="/Public/dist/js/app.min.js"></script>
<!-- AdminLTE for demo purposes -->
<script type="text/javascript" data-src="/Public/dist/js/demo.js"></script>

<!-- Optionally, you can add Slimscroll and FastClick plugins.
     Both of these plugins are recommended to enhance the
     user experience. Slimscroll is required when using the
     fixed layout. -->
<!-- cookie -->
<script type="text/javascript" src="/Public/dist/js/jquery.cookie.js"></script>

<!-- 自定义公共js -->
<script type="text/javascript" src="/Public/dist/js/custom.js"></script>
<script type="text/javascript" src="/Public/dist/js/dialog.js"></script>

<!-- 表格功能 -->
<script type="text/javascript" src="/Public/plugins/bootstrap-table/bootstrap-table.js"></script>
<script type="text/javascript" src="/Public/plugins/bootstrap-table/bootstrap-table-zh-CN.js"></script>

<!-- 表格导出数据 -->
<script type="text/javascript" src="/Public/plugins/bootstrap-table/bootstrap-table-export.js"></script>
<script type="text/javascript" src="/Public/plugins/bootstrap-table/tableExport.js"></script>

<!-- 开关按钮 -->
<script type="text/javascript" src="/Public/plugins/switch/bootstrap-switch.js"></script>

<!-- ztree -->
<script type="text/javascript" src="/Public/plugins/ztree/jquery.ztree.all.js"></script>

<!-- 日期 时间 -->
<script type="text/javascript" src="/Public/plugins/datetimepicker/jquery.datetimepicker.full.js"></script>

<!-- layer弹出层 -->
<script type="text/javascript" src="/Public/plugins/layer/layer.js"></script>

<!-- iCheck 1.0.1 -->
<script type="text/javascript" src="/Public/plugins/iCheck/icheck.min.js"></script>

<script>
var userIdvVal = getLocationString('user_id');
function getLocationString(name) {  
  // 如果链接没有参数，或者链接中不存在我们要获取的参数，直接返回空  
  if(location.href.indexOf("?")==-1 || location.href.indexOf(name+'=')==-1)  
  {  
      return '';  
  }  
  // 获取链接中参数部分  
  var queryString = location.href.substring(location.href.indexOf("?")+1);  
 
  // 分离参数对 ?key=value&key2=value2  
  var parameters = queryString.split("&");  
 
  var pos, paraName, paraValue;  
  for(var i=0; i<parameters.length; i++)  
  {  
      // 获取等号位置  
      pos = parameters[i].indexOf('=');  
      if(pos == -1) { continue; }  
 
      // 获取name 和 value  
      paraName = parameters[i].substring(0, pos);  
      paraValue = parameters[i].substring(pos + 1);  
 
      // 如果查询的name等于当前name，就返回当前值，同时，将链接中的+号还原成空格  
      if(paraName == name)  
      {  
          return unescape(paraValue.replace(/\+/g, " "));  
      }  
  }  
  return '';  
}; 

$(function() {
  // 表格数据
  var $table = $('#referrer_table1');
  var $g_params = {};
  // table 功能设置
  $table.bootstrapTable({
    toolbar:"#toolbar",                   // 工具栏
    toggle:"table",                       // 表格
    showToggle:true,                      // 是否显示(表格样式)切换
    showColumns:true,                     // 是否显示列(功能:[显示/隐藏]列)
    showExport:true,                      // 是否显示导出
    pagination:true,                      // 分页
    pageList:[10, 25, 50, 100],           // 每页行数
    ajax:"ajaxRequest",                   // 数据地址
    sidePagination:"server"               // 服务器
  });
});


// 隐藏域赋值
function searchForm() {
  $("#begin_time").val($("#begin_time2").val());
  $("#end_time").val($("#end_time2").val());
 $("#user_id").val(userIdvVal);

}


// 自定义ajax请求
function ajaxRequest(params) {
  $g_params = params;
  searchForm();
  // 需要的数据
  var url = "/index.php/Admin/Referrer/Referrer/getReferrer?" + $("#searchForm").serialize();
  queryList(url,params);
}

function search(){
  searchForm();
  // 需要的数据
  var url = "/index.php/Admin/Referrer/Referrer/getReferrer?" + $("#searchForm").serialize();
  $g_params.data.page = parseInt($('.pagination li.active a').text());
  queryList(url,$g_params);
}

// 自定义查看表格中的操作内容
function viewInviterFormatter(value, row, index) {
  console.log(row);
    if(row.type==9||row.type==10||row.type==11||row.type==12||row.type==13||row.type==14){
    return [
      '<button type="button" class="btn btn-primary table-btn viewInviter" style="margin:0 10px 0 0;" data-color="#39B3D7" data-opacity="0.95">',
      '<i class="fa fa-eye"></i> 查看邀请人',
      '</button>'
    ].join('');
  }
}

//获取用户id
window.viewInviterEvents = {
  'click .viewInviter': function (e, value, row, index) {   
    viewInviteretails(row.user_id)
  }
};

// 跳转到展示邀请人页面及传值
function viewInviteretails(id) {
top.layer.open({
  type: 2,
  title: '查看邀请人',
  shadeClose: true,
  shade: 0.2,
  area: ['70%', '70%'],
  content: "/index.php/Admin/Referrer/Referrer/showUserList?user_id="+id
});
}

//弹出层内容高度
function modalWindowH() {
    $('.content').css({
      height: $('.layui-layer-content',window.parent.document).height(),
      overflow: 'auto'
    });
  }
  modalWindowH();
  $(window).resize(function() {
    modalWindowH();
  });


// 日期 时间
$.datetimepicker.setLocale('ch'); 
$('.dataTime').datetimepicker({
  // lang:"ch",            // 语言选择中文
  format:"Y-m-d H:i", // 格式化日期 时间
  timepicker:true,      // 时间选项
  step:5,               // 分钟步数
  yearStart:2000,       // 设置最小年份
  yearEnd:2050,         // 设置最大年份
  todayButton:true      // 选择今天按钮
});

$('#begin_time2').datetimepicker({
  onShow:function(ct) {
    this.setOptions({
      maxDate:jQuery('#end_time2').val()?jQuery('#end_time2').val():false
    })
  },
  timepicker:true
});
jQuery('#end_time2').datetimepicker({
  onShow:function(ct) {
    this.setOptions({
      minDate:jQuery('#begin_time2').val()?jQuery('#begin_time2').val():false
    })
  },
  timepicker:true
}); 

</script>
</body>
</html>